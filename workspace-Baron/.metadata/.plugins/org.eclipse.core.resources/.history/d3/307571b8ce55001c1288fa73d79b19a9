package fr.mickaelbaron.jaxrstutorialexercice2;

import java.util.List;
import java.util.Optional;

import javax.ws.rs.GET;
import javax.ws.rs.NotFoundException;
import javax.ws.rs.Path;
import javax.ws.rs.PathParam;
import javax.ws.rs.Produces;
import javax.ws.rs.QueryParam;
import javax.ws.rs.core.MediaType;
import javax.ws.rs.core.Response;

// TODO: le chemin racine de la ressource doit débuter par `/trains`.
@Path("trains")
// TODO: les formats du contenu des réponses sont XML puis JSON.
@Produces(MediaType.TEXT_XML)
public class TrainResource {

    public TrainResource() { }

    // TODO: préciser le verbe HTTP.
    @GET
    public List<Train> getTrains() {
        System.out.println("getTrains");

        return TrainBookingDB.getTrains();
    }

    // TODO: préciser le verbe HTTP
    @GET
    // TODO: le chemin doit commencer par `/trainid-`  et se finir
    // par un template paramètre désignant l'identifiant du train.
    @Path("trainid-{id}")
    public Train getTrain(@PathParam("id") String trainId) {
        System.out.println("getTrain");

        Optional<Train> trainById = TrainBookingDB.getTrainById(trainId);

        if (trainById.isPresent()) {
            return trainById.get();
        } else {
            // TODO: déclencher une exception avec un statut NOT_FOUND.
        	throw new NotFoundException() ;
        }
    }

    // TODO: préciser le verbe HTTP.
    @GET
    // TODO: le chemin doit commencer par `/search`.
    // Les paramètres sont tous des paramètres de requête.
    @Path("search")
    public Response searchTrainsByCriteria(@QueryParam("departure") String departure, @QueryParam("arrival") String arrival, @QueryParam("departureTime") String departureTime) {
        System.out.println("TrainResource.searchTrainsByCriteria()");

        // TODO: retourner une réponse avec :
        //   1/ les trois paramètres de requête en en-tête
        //   2/ un sous-ensemble de la liste des trains
        //      (exemple : `TrainBookingDB.getTrains().subList(0, 2)`)
        return Response.ok().
    }
}
